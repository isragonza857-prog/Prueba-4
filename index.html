<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BuzÃ³n de Amor ðŸ’Œ</title>
    <style>
        :root { --rosa: #ff4d6d; --texto: #590d22; }
        body { 
            background-image: url('https://i.postimg.cc/LXs6wcwy/65a54829cbbe07a6302459f35420ec2e.jpg');
            background-size: cover; background-position: center; background-attachment: fixed;
            font-family: sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; color: var(--texto); overflow-x: hidden;
        }
        h1 { margin: 20px 0; font-size: 1.6rem; text-align: center; z-index: 2; background: rgba(255, 255, 255, 0.7); padding: 10px 25px; border-radius: 50px; backdrop-filter: blur(4px); }
        .btn-notif { background: var(--rosa); color: white; border: none; padding: 12px 25px; border-radius: 25px; font-weight: bold; margin-bottom: 25px; cursor: pointer; z-index: 2; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        #contenedor { width: 100%; max-width: 400px; z-index: 2; }
        .carta { background: rgba(255, 255, 255, 0.9); padding: 20px; margin-bottom: 15px; border-radius: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); border-left: 8px solid var(--rosa); backdrop-filter: blur(5px); }
        .bloqueada { background: rgba(240, 240, 240, 0.8); border-left-color: #adb5bd; }
        .tag { display: block; font-size: 0.75rem; color: var(--rosa); font-weight: bold; margin-bottom: 5px; }
        .corazon-bg { position: fixed; top: -10%; font-size: 20px; user-select: none; pointer-events: none; animation: fall linear forwards; z-index: 1; }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }
    </style>
</head>
<body>

    <h1>ðŸ’Œ Nuestro BuzÃ³n MÃ¡gico</h1>
    <button class="btn-notif" id="btnNotif" onclick="pedirPermiso()">ðŸ”” Activar Notificaciones</button>
    <div id="contenedor">Cargando magia aleatoria...</div>

    <script>
        const frasesOriginales = [
            "1. Â¡Te amo! â¤ï¸", "2. Eres mi sol â˜€ï¸", "3. Mi lugar favorito eres tÃº ðŸ ",
            "4. Eres mi vida ðŸ˜", "5. Te extraÃ±o ðŸŒ¹", "6. Siempre juntos ðŸ‘©â€â¤ï¸â€ðŸ‘¨",
            "7. Eres magia âœ¨", "8. Mi mundo entero ðŸŒŽ", "9. Gracias por existir ðŸ¤—",
            "10. Te pienso siempre ðŸ’­", "11. Eres mi sueÃ±o hecho realidad ðŸŒ™", "12. Eres mi todo ðŸ’–",
            "13. Te amo cada dÃ­a mÃ¡s ðŸ“ˆ", "14. Eres mi debilidad ðŸ’‹", "15. Me haces muy feliz ðŸ˜Š",
            "16. Contigo todo es mejor ðŸŒŸ", "17. Eres Ãºnica ðŸ’Ž", "18. Mi corazÃ³n late por ti ðŸ’“",
            "19. Eres mi mejor regalo ðŸŽ", "20. Te quiero hoy y siempre â™¾ï¸", "21. Eres mi paz ðŸ•Šï¸",
            "22. Brillas mÃ¡s que el sol â˜€ï¸", "23. Eres mi hogar ðŸ—ï¸", "24. Te amo infinito ðŸŒŒ",
            "25. Eres mi tesoro ðŸ’°", "26. Eres mi persona favorita ðŸ¥°", "27. Te amo demasiado ðŸ’˜",
            "28. Mi razÃ³n de sonreÃ­r ðŸ˜", "29. Eres mi bendiciÃ³n ðŸ™", "30. Mi alma gemela ðŸ§©",
            "31. Te amo locamente ðŸ¤ª", "32. Eres mi motivaciÃ³n ðŸ’ª", "33. Siempre en mi mente ðŸ§ ",
            "34. Eres mi alegrÃ­a ðŸ˜„", "35. Te adoro ðŸ™‡â€â™‚ï¸", "36. Mi vida entera es tuya ðŸ’“",
            "37. Eres increÃ­ble ðŸŒˆ", "38. Mi amor por ti no tiene fin ðŸ›‘", "39. Eres mi Ã¡ngel ðŸ˜‡",
            "40. Te amo con toda mi alma ðŸ‘»", "41. Eres mi tesoro ðŸ’", "42. Te amo, preciosa ðŸ‘¸",
            "43. Eres mi suerte ðŸ€", "44. Te amo cada segundo â±ï¸", "45. Mi destino eres tÃº ðŸ›£ï¸",
            "46. Eres perfecta ðŸŽ¯", "47. Te amo, corazÃ³n ðŸ’–", "48. Eres mi cielo â˜ï¸",
            "49. Siempre tÃº ðŸ‘ˆ", "50. Te amo, hermosa ðŸŒ¸", "51. Mi refugio ðŸ°",
            "52. Eres mi luz ðŸ’¡", "53. Te amo tanto ðŸ”¥", "54. Mi todo ðŸ¥‡",
            "55. Eres mi calma ðŸŒŠ", "56. Te amo, amor de mi vida ðŸ’", "57. Eres mi realidad ðŸ‘“",
            "58. Siempre te elegirÃ© ðŸ—³ï¸", "59. Eres mi mejor aventura ðŸ§­", "60. Â¡Completamos un mes de amor! âœ¨"
        ];

        const INTERVALO_HORAS = 12;

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(err => console.log("SW error", err));
        }

        function pedirPermiso() {
            Notification.requestPermission().then(p => {
                if(p === "granted") {
                    document.getElementById('btnNotif').style.display = 'none';
                    enviarNotificacion("Â¡BuzÃ³n Activado! â¤ï¸", "RecibirÃ¡s sorpresas cada 12 horas.");
                }
            });
        }

        function enviarNotificacion(titulo, mensaje) {
            if (Notification.permission === "granted" && navigator.serviceWorker.controller) {
                navigator.serviceWorker.ready.then(reg => {
                    reg.showNotification(titulo, {
                        body: mensaje,
                        icon: 'https://cdn-icons-png.flaticon.com/512/833/833472.png',
                        badge: 'https://cdn-icons-png.flaticon.com/512/833/833472.png',
                        vibrate: [200, 100, 200]
                    });
                });
            }
        }

        function barajar(array) {
            let actual = [...array];
            for (let i = actual.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [actual[i], actual[j]] = [actual[j], actual[i]];
            }
            return actual;
        }

        function crearCorazon() {
            const c = document.createElement('div');
            c.className = 'corazon-bg';
            c.innerHTML = 'â¤ï¸';
            c.style.left = Math.random() * 100 + 'vw';
            c.style.animationDuration = Math.random() * 3 + 2 + 's';
            c.style.opacity = 0.6;
            document.body.appendChild(c);
            setTimeout(() => c.remove(), 5000);
        }
        setInterval(crearCorazon, 600);

        function mostrar() {
            const cont = document.getElementById('contenedor');
            const ahora = Date.now();
            
            let inicio = localStorage.getItem('INICIO_RANDOM_FINAL');
            let frasesOrdenadas = JSON.parse(localStorage.getItem('ORDEN_FRASES_FINAL'));
            const tiempoTotal = frasesOriginales.length * INTERVALO_HORAS * 3600000;
            
            if (!inicio || (ahora - parseInt(inicio)) > tiempoTotal) {
                inicio = ahora.toString();
                frasesOrdenadas = barajar(frasesOriginales);
                localStorage.setItem('INICIO_RANDOM_FINAL', inicio);
                localStorage.setItem('ORDEN_FRASES_FINAL', JSON.stringify(frasesOrdenadas));
                frasesOriginales.forEach((, i) => localStorage.removeItem('vn60' + i));
            }

            let html = '';
            frasesOrdenadas.forEach((texto, i) => {
                const tiempoDesbloqueo = parseInt(inicio) + (i * INTERVALO_HORAS * 3600000);
                
                if (ahora >= tiempoDesbloqueo) {
                    html += <div class="carta"><span class="tag">âœ¨ SORPRESA #${i+1}</span><p>${texto}</p></div>;
                    if (!localStorage.getItem('vn60_' + i) && i > 0) {
                        enviarNotificacion("Â¡Nueva Carta! ðŸ’Œ", "Tienes un mensaje nuevo esperÃ¡ndote.");
                        localStorage.setItem('vn60_' + i, "true");
                    }
                } else {
                    const r = tiempoDesbloqueo - ahora;
                    const d = Math.floor(r / 86400000);
                    const hr = Math.floor((r % 86400000) / 3600000);
                    const m = Math.floor((r % 3600000) / 60000);
                    const s = Math.floor((r % 60000) / 1000);
                    html += <div class="carta bloqueada"><span class="tag">ðŸ”’ PRÃ“XIMA SORPRESA EN:</span><p>${d}d ${hr}h ${m}m ${s}s</p></div>;
                }
            });
            cont.innerHTML = html;
        }

        if (Notification.permission === "granted") document.getElementById('btnNotif').style.display = 'none';
        mostrar();
        setInterval(mostrar, 1000);
    </script>
</body>
</html>
